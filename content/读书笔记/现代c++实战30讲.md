# åŸºç¡€ç¯‡

## 01 å †ã€æ ˆã€RAIIï¼šC++é‡Œè¯¥å¦‚ä½•ç®¡ç†èµ„æº

### å †

å†…å­˜æ³„æ¼æ¡ˆä¾‹ï¼š

```c
void foo()
{
  bar* ptr = new bar();
  â€¦
  delete ptr;
}
```

ä¸Šè¿°ä»£ç å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š

1. ä¸­é—´çœç•¥çš„ä»£ç éƒ¨åˆ†ä¹Ÿè®¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå¯¼è‡´æœ€åçš„ delete ptr å¾—ä¸åˆ°æ‰§è¡Œã€‚
2. æ›´é‡è¦çš„ï¼Œè¿™ä¸ªä»£ç ä¸ç¬¦åˆ C++ çš„æƒ¯ç”¨æ³•ã€‚åœ¨ C++ é‡Œï¼Œè¿™ç§æƒ…å†µä¸‹æœ‰ 99% çš„å¯èƒ½æ€§ä¸åº”è¯¥ä½¿ç”¨å †å†…å­˜åˆ†é…ï¼Œè€Œåº”ä½¿ç”¨æ ˆå†…å­˜åˆ†é…ã€‚è¿™æ ·å†™ä»£ç çš„ï¼Œä¼°è®¡å¯èƒ½æ˜¯ä» Java è½¬è¿‡æ¥çš„ğŸ¤­â€”â€”ä½†æˆ‘çœŸè§è¿‡è¿™æ ·çš„ä»£ç ã€‚

è€Œæ›´åˆç†çš„æƒ…å†µå¦‚ä¸‹ï¼š

```c
bar* make_bar(â€¦)
{
  bar* ptr = nullptr;
  try {
    ptr = new bar();
    â€¦
  }
  catch (...) {
    delete ptr;
    throw;
  }
  return ptr;
}

void foo()
{
  â€¦
  bar* ptr = make_bar(â€¦)
  â€¦
  delete ptr;
}
```

### RAII

C++ æ”¯æŒå°†å¯¹è±¡å­˜å‚¨åœ¨æ ˆä¸Šé¢ã€‚ä½†æ˜¯ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå¯¹è±¡ä¸èƒ½ï¼Œæˆ–ä¸åº”è¯¥ï¼Œå­˜å‚¨åœ¨**æ ˆ**ä¸Šã€‚æ¯”å¦‚ï¼š

- å¯¹è±¡å¾ˆå¤§
- å¯¹è±¡çš„å¤§å°åœ¨ç¼–è¯‘æ—¶ä¸èƒ½ç¡®å®š
- å¯¹è±¡æ—¶å‡½æ•°çš„è¿”å›å€¼ï¼Œä½†æ˜¯ç”±äºç‰¹æ®Šçš„åŸå› ï¼Œä¸åº”ä½¿ç”¨å¯¹è±¡çš„å€¼è¿”å›



å¸¸è§æƒ…å†µä¹‹ä¸€ï¼Œåœ¨å·¥å‚æ–¹æ³•æˆ–å…¶ä»–é¢å‘å¯¹è±¡ç¼–ç¨‹çš„æƒ…å†µä¸‹ï¼Œè¿”å›å€¼ç±»å‹æ˜¯åŸºç±»ï¼ˆçš„æŒ‡é’ˆæˆ–å¼•ç”¨ï¼‰ã€‚ä¸‹é¢çš„ä¾‹å­ï¼Œæ˜¯å¯¹å·¥å‚æ–¹æ³•çš„ç®€å•æ¼”ç¤ºï¼š

```c
enum class shape_type {
  circle,
  triangle,
  rectangle,
  â€¦
};

class shape { â€¦ };
class circle : public shape { â€¦ };
class triangle : public shape { â€¦ };
class rectangle : public shape { â€¦ };

shape* create_shape(shape_type type)
{
  â€¦
  switch (type) {
  case shape_type::circle:
    return new circle(â€¦);
  case shape_type::triangle:
    return new triangle(â€¦);
  case shape_type::rectangle:
    return new rectangle(â€¦);
  â€¦
  }
}
```

???  è¿™ä¸ª create_shape æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ª shape å¯¹è±¡ï¼Œå¯¹è±¡çš„å®é™…ç±»å‹æ˜¯æŸä¸ª shape çš„å­ç±»ï¼Œåœ†å•Šï¼Œä¸‰è§’å½¢å•Šï¼ŒçŸ©å½¢å•Šï¼Œç­‰ç­‰ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå‡½æ•°çš„è¿”å›å€¼åªèƒ½æ˜¯æŒ‡é’ˆæˆ–å…¶å˜ä½“å½¢å¼ã€‚å¦‚æœè¿”å›ç±»å‹æ˜¯ shapeï¼Œå®é™…å´è¿”å›ä¸€ä¸ª circleï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œä½†ç»“æœå¤šåŠæ˜¯é”™çš„ã€‚è¿™ç§ç°è±¡å«å¯¹è±¡åˆ‡ç‰‡ï¼ˆobject slicingï¼‰ï¼Œæ˜¯ C++ ç‰¹æœ‰çš„ä¸€ç§ç¼–ç é”™è¯¯ã€‚è¿™ç§é”™è¯¯ä¸æ˜¯è¯­æ³•é”™è¯¯ï¼Œè€Œæ˜¯ä¸€ä¸ªå¯¹è±¡å¤åˆ¶ç›¸å…³çš„è¯­ä¹‰é”™è¯¯ï¼Œä¹Ÿç®—æ˜¯ C++ çš„ä¸€ä¸ªé™·é˜±äº†ï¼Œå¤§å®¶éœ€è¦å°å¿ƒè¿™ä¸ªé—®é¢˜ã€‚

é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€æ ·æ‰èƒ½ç¡®ä¿ï¼Œåœ¨ä½¿ç”¨ create_shape çš„è¿”å›å€¼æ—¶ä¸ä¼šå‘ç”Ÿå†…å­˜æ³„æ¼å‘¢ï¼Ÿ

ç­”æ¡ˆå°±åœ¨ææ„å‡½æ•°å’Œå®ƒçš„æ ˆå±•å¼€è¡Œä¸ºä¸Šã€‚æˆ‘ä»¬åªéœ€è¦æŠŠè¿™ä¸ªè¿”å›å€¼æ”¾åˆ°ä¸€ä¸ªæœ¬åœ°å˜é‡é‡Œï¼Œå¹¶ç¡®ä¿å…¶ææ„å‡½æ•°ä¼šåˆ é™¤è¯¥å¯¹è±¡å³å¯ã€‚ä¸€ä¸ªç®€å•çš„å®ç°å¦‚ä¸‹æ‰€ç¤ºï¼š

```c++
enum class shape_type {
  circle,
  triangle,
  rectangle,
  â€¦
};

class shape { â€¦ };
class circle : public shape { â€¦ };
class triangle : public shape { â€¦ };
class rectangle : public shape { â€¦ };


class shape_wrapper {
public:
  explicit shape_wrapper(shape* ptr = nullptr): ptr_(ptr) {}
  
  ~shape_wrapper()
  {
    delete ptr_;
  }
  
  shape* get() const { return ptr_; }
  
private:
  shape* ptr_;
};

void foo()
{
  â€¦
  shape_wrapper ptr_wrapper(
    create_shape(â€¦));
  â€¦
}
```

å¦‚æœä½ å¥½å¥‡ delete ç©ºæŒ‡é’ˆä¼šå‘ç”Ÿä»€ä¹ˆçš„è¯ï¼Œé‚£ç­”æ¡ˆæ˜¯ï¼Œè¿™æ˜¯ä¸€ä¸ªåˆæ³•çš„ç©ºæ“ä½œã€‚

```c
if (ptr != nullptr) {
  ptr->~shape();
  operator delete(ptr);
}
```

å›åˆ° shape_wrapper å’Œå®ƒçš„ææ„è¡Œä¸ºã€‚åœ¨ææ„å‡½æ•°é‡Œåšå¿…è¦çš„æ¸…ç†å·¥ä½œï¼Œè¿™å°±æ˜¯ RAII çš„åŸºæœ¬ç”¨æ³•ã€‚è¿™ç§æ¸…ç†å¹¶ä¸é™äºé‡Šæ”¾å†…å­˜ï¼Œä¹Ÿå¯ä»¥æ˜¯ï¼š

- å…³é—­æ–‡ä»¶ï¼ˆfstream çš„ææ„å°±ä¼šè¿™ä¹ˆåšï¼‰
- é‡Šæ”¾åŒæ­¥é”
- é‡Šæ”¾å…¶ä»–é‡è¦çš„ç³»ç»Ÿèµ„æº

## 02 è‡ªå·±åŠ¨æ‰‹ï¼Œå®ç°C++çš„æ™ºèƒ½æŒ‡é’ˆ

### å›é¡¾

æˆ‘ä»¬ä¸Šä¸€è®²ç»™å‡ºäº†ä¸‹é¢è¿™ä¸ªç±»ï¼š

```c++
class shape_wrapper {
public:
  explicit shape_wrapper(shape* ptr = nullptr): ptr_(ptr) {}
    
  ~shape_wrapper()
  {
    delete ptr_;
  }
  shape* get() const { return ptr_; }

private:
  shape* ptr_;
};
```

*explicitï¼šæŒ‡å®šæ„é€ å‡½æ•°æˆ–è½¬æ¢å‡½æ•° (C++11 èµ·) æˆ–æ¨å¯¼æŒ‡å— (C++17 èµ·) æ˜¯æ˜¾å¼çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸èƒ½ç”¨äºéšå¼è½¬æ¢å’Œå¤åˆ¶åˆå§‹åŒ–ã€‚*

è¿™ä¸ªç±»å¯ä»¥å®Œæˆæ™ºèƒ½æŒ‡é’ˆçš„æœ€åŸºæœ¬çš„åŠŸèƒ½ï¼šå¯¹è¶…å‡ºä½œç”¨åŸŸçš„å¯¹è±¡è¿›è¡Œé‡Šæ”¾ã€‚**ä½†å®ƒç¼ºäº†ç‚¹ä¸œè¥¿ï¼š**

1. è¿™ä¸ªç±»åªé€‚ç”¨äº shape ç±»
2. è¯¥ç±»å¯¹è±¡çš„è¡Œä¸ºä¸å¤ŸåƒæŒ‡é’ˆ
3. æ‹·è´è¯¥ç±»å¯¹è±¡ä¼šå¼•å‘ç¨‹åºè¡Œä¸ºå¼‚å¸¸

ä¸‹é¢æˆ‘ä»¬æ¥é€ä¸€çœ‹ä¸€ä¸‹æ€ä¹ˆå¼¥è¡¥è¿™äº›é—®é¢˜ã€‚

### æ¨¡æ¿åŒ–å’Œæ˜“ç”¨æ€§

è¦è®©è¿™ä¸ªç±»èƒ½å¤ŸåŒ…è£…ä»»æ„ç±»å‹çš„æŒ‡é’ˆï¼Œæˆ‘ä»¬éœ€è¦æŠŠå®ƒå˜æˆä¸€ä¸ªç±»æ¨¡æ¿ã€‚è¿™å®é™…ä¸Šç›¸å½“å®¹æ˜“ï¼š

```c++
template <typename T>
class smart_ptr {
public:
  explicit smart_ptr(T* ptr = nullptr) : ptr_(ptr) {}
  ~smart_ptr()
  {
    delete ptr_;
  }
  T* get() const { return ptr_; }
    
private:
  T* ptr_;
};
```

*ç§»åŠ¨æ„é€ å‡½æ•°ï¼š*

*=deleteï¼ŒC++11ä¸­ï¼Œå½“æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªç±»çš„æˆå‘˜å‡½æ•°æ—¶ï¼Œå¦‚æœåé¢ä½¿ç”¨"=delete"å»ä¿®é¥°ï¼Œé‚£ä¹ˆå°±è¡¨ç¤ºè¿™ä¸ªå‡½æ•°è¢«å®šä¹‰ä¸ºdeletedï¼Œä¹Ÿå°±æ„å‘³ç€è¿™ä¸ªæˆå‘˜å‡½æ•°ä¸èƒ½å†è¢«è°ƒç”¨ï¼Œå¦åˆ™å°±ä¼šå‡ºé”™ã€‚*

#### å¼•ç”¨è®¡æ•°

unique_ptr å’Œ shared_ptr çš„ä¸»è¦åŒºåˆ«å¦‚ä¸‹ï¼š

![image-20220313093010188](../images/image-20220313093010188.png)

ç°åœ¨æˆ‘ä»¬å¯ä»¥å®ç°æˆ‘ä»¬çš„å¼•ç”¨è®¡æ•°æ™ºèƒ½æŒ‡é’ˆäº†ã€‚é¦–å…ˆæ˜¯æ„é€ å‡½æ•°ã€ææ„å‡½æ•°å’Œç§æœ‰æˆå‘˜å˜é‡ï¼š

```c++
template <typename T>
class smart_ptr {
public:
  explicit smart_ptr(T* ptr = nullptr)
    : ptr_(ptr)
  {
    if (ptr) {
      shared_count_ =
        new shared_count();
    }
  }
  ~smart_ptr()
  {
    if (ptr_ &&
      !shared_count_
         ->reduce_count()) {
      delete ptr_;
      delete shared_count_;
    }
  }

private:
  T* ptr_;
  shared_count* shared_count_;
};
```



ä¸‹é¢æ˜¯ä¸€ä¸ªå®Œæ•´çš„ smart_ptr ä»£ç ï¼š

```c++
#include <utility>  // std::swap

class shared_count {
public:
  shared_count() noexcept
    : count_(1) {}
  void add_count() noexcept
  {
    ++count_;
  }
  long reduce_count() noexcept
  {
    return --count_;
  }
  long get_count() const noexcept
  {
    return count_;
  }

private:
  long count_;
};

template <typename T>
class smart_ptr {
public:
  template <typename U>
  friend class smart_ptr;

  explicit smart_ptr(T* ptr = nullptr)
    : ptr_(ptr)
  {
    if (ptr) {
      shared_count_ =
        new shared_count();
    }
  }
  ~smart_ptr()
  {
    if (ptr_ &&
      !shared_count_
         ->reduce_count()) {
      delete ptr_;
      delete shared_count_;
    }
  }

  smart_ptr(const smart_ptr& other)
  {
    ptr_ = other.ptr_;
    if (ptr_) {
      other.shared_count_
        ->add_count();
      shared_count_ =
        other.shared_count_;
    }
  }
  template <typename U>
  smart_ptr(const smart_ptr<U>& other) noexcept
  {
    ptr_ = other.ptr_;
    if (ptr_) {
      other.shared_count_->add_count();
      shared_count_ = other.shared_count_;
    }
  }
  template <typename U>
  smart_ptr(smart_ptr<U>&& other) noexcept
  {
    ptr_ = other.ptr_;
    if (ptr_) {
      shared_count_ =
        other.shared_count_;
      other.ptr_ = nullptr;
    }
  }
  template <typename U>
  smart_ptr(const smart_ptr<U>& other,
            T* ptr) noexcept
  {
    ptr_ = ptr;
    if (ptr_) {
      other.shared_count_
        ->add_count();
      shared_count_ =
        other.shared_count_;
    }
  }
  smart_ptr&
  operator=(smart_ptr rhs) noexcept
  {
    rhs.swap(*this);
    return *this;
  }

  T* get() const noexcept
  {
    return ptr_;
  }
  long use_count() const noexcept
  {
    if (ptr_) {
      return shared_count_
        ->get_count();
    } else {
      return 0;
    }
  }
  void swap(smart_ptr& rhs) noexcept
  {
    using std::swap;
    swap(ptr_, rhs.ptr_);
    swap(shared_count_,
         rhs.shared_count_);
  }

  T& operator*() const noexcept
  {
    return *ptr_;
  }
  T* operator->() const noexcept
  {
    return ptr_;
  }
  operator bool() const noexcept
  {
    return ptr_;
  }

private:
  T* ptr_;
  shared_count* shared_count_;
};

template <typename T>
void swap(smart_ptr<T>& lhs,
          smart_ptr<T>& rhs) noexcept
{
  lhs.swap(rhs);
}

template <typename T, typename U>
smart_ptr<T> static_pointer_cast(
  const smart_ptr<U>& other) noexcept
{
  T* ptr = static_cast<T*>(other.get());
  return smart_ptr<T>(other, ptr);
}

template <typename T, typename U>
smart_ptr<T> reinterpret_pointer_cast(
  const smart_ptr<U>& other) noexcept
{
  T* ptr = reinterpret_cast<T*>(other.get());
  return smart_ptr<T>(other, ptr);
}

template <typename T, typename U>
smart_ptr<T> const_pointer_cast(
  const smart_ptr<U>& other) noexcept
{
  T* ptr = const_cast<T*>(other.get());
  return smart_ptr<T>(other, ptr);
}

template <typename T, typename U>
smart_ptr<T> dynamic_pointer_cast(
  const smart_ptr<U>& other) noexcept
{
  T* ptr = dynamic_cast<T*>(other.get());
  return smart_ptr<T>(other, ptr);
}
```



# 03 | å³å€¼å’Œç§»åŠ¨ç©¶ç«Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ

> C++ é‡Œï¼Œæ‰€æœ‰çš„åŸç”Ÿç±»å‹ã€æšä¸¾ã€ç»“æ„ã€è”åˆã€ç±»éƒ½ä»£è¡¨å€¼ç±»å‹ï¼Œåªæœ‰å¼•ç”¨ï¼ˆ&ï¼‰å’ŒæŒ‡é’ˆï¼ˆ*ï¼‰æ‰æ˜¯å¼•ç”¨ç±»å‹ã€‚åœ¨ Java é‡Œï¼Œæ•°å­—ç­‰åŸç”Ÿç±»å‹æ˜¯å€¼ç±»å‹ï¼Œç±»åˆ™å±äºå¼•ç”¨ç±»å‹ã€‚åœ¨ Python é‡Œï¼Œä¸€åˆ‡ç±»å‹éƒ½æ˜¯å¼•ç”¨ç±»å‹ã€‚

## **ç”Ÿå‘½å‘¨æœŸå’Œè¡¨è¾¾å¼ç±»å‹**

> C++ çš„è§„åˆ™æ˜¯ï¼šä¸€ä¸ªä¸´æ—¶å¯¹è±¡ä¼šåœ¨åŒ…å«è¿™ä¸ªä¸´æ—¶å¯¹è±¡çš„å®Œæ•´è¡¨è¾¾å¼ä¼°å€¼å®Œæˆåã€æŒ‰ç”Ÿæˆé¡ºåºçš„é€†åºè¢«é”€æ¯ï¼Œé™¤éæœ‰ç”Ÿå‘½å‘¨æœŸå»¶é•¿å‘ç”Ÿã€‚

C++ å¯¹ä¸´æ—¶å¯¹è±¡æœ‰ç‰¹æ®Šçš„ç”Ÿå‘½å‘¨æœŸå»¶é•¿è§„åˆ™ã€‚è¿™æ¡è§„åˆ™æ˜¯ï¼š

> å¦‚æœä¸€ä¸ª prvalue ï¼ˆçº¯å³å€¼ï¼‰è¢«ç»‘å®šåˆ°ä¸€ä¸ªå¼•ç”¨ä¸Šï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸåˆ™ä¼šå»¶é•¿åˆ°è·Ÿè¿™ä¸ªå¼•ç”¨å˜é‡ä¸€æ ·é•¿ã€‚

## ç§»åŠ¨çš„æ„ä¹‰

åœ¨ä½¿ç”¨å®¹å™¨ç±»çš„æƒ…å†µä¸‹ï¼Œç§»åŠ¨æ›´æœ‰æ„ä¹‰ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•åˆ†æä¸€ä¸‹ä¸‹é¢è¿™ä¸ªå‡æƒ³çš„è¯­å¥ï¼ˆå‡è®¾ name æ˜¯ string ç±»å‹ï¼‰ï¼š

```c++
string result =
  string("Hello, ") + name + ".";
```

åœ¨ C++11 ä¹‹å‰çš„å¹´ä»£é‡Œï¼Œè¿™ç§å†™æ³•æ˜¯ç»å¯¹ä¸æ¨èçš„ã€‚å› ä¸ºå®ƒä¼šå¼•å…¥å¾ˆå¤šé¢å¤–å¼€é”€ï¼Œæ‰§è¡Œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

1. è°ƒç”¨æ„é€ å‡½æ•° string(const char*)ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ 1ï¼›"Hello, " å¤åˆ¶ 1 æ¬¡ã€‚*
2. *è°ƒç”¨ operator+(const string&, const string&)ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ 2ï¼›"Hello, " å¤åˆ¶ 2 æ¬¡ï¼Œname å¤åˆ¶ 1 æ¬¡ã€‚*
3. *è°ƒç”¨ operator+(const string&, const char*)ï¼Œç”Ÿæˆå¯¹è±¡ 3ï¼›"Hello, " å¤åˆ¶ 3 æ¬¡ï¼Œname å¤åˆ¶ 2 æ¬¡ï¼Œ"." å¤åˆ¶ 1 æ¬¡ã€‚
4. å‡è®¾è¿”å›å€¼ä¼˜åŒ–èƒ½å¤Ÿç”Ÿæ•ˆï¼ˆæœ€ä½³æƒ…å†µï¼‰ï¼Œå¯¹è±¡ 3 å¯ä»¥ç›´æ¥åœ¨ result é‡Œæ„é€ å®Œæˆã€‚
5. ä¸´æ—¶å¯¹è±¡ 2 ææ„ï¼Œé‡Šæ”¾æŒ‡å‘ string("Hello, ") + name çš„å†…å­˜ã€‚
6. ä¸´æ—¶å¯¹è±¡ 1 ææ„ï¼Œé‡Šæ”¾æŒ‡å‘ string("Hello, ") çš„å†…å­˜ã€‚

æ—¢ç„¶ C++ æ˜¯ä¸€é—¨è¿½æ±‚æ€§èƒ½çš„è¯­è¨€ï¼Œä¸€ä¸ªåˆæ ¼çš„ C++ ç¨‹åºå‘˜ä¼šå†™ï¼š

```c++
string result = "Hello, ";
result += name;
result += ".";
```

è¿™æ ·çš„è¯ï¼Œåªä¼šè°ƒç”¨æ„é€ å‡½æ•°ä¸€æ¬¡å’Œ string::operator+= ä¸¤æ¬¡ï¼Œæ²¡æœ‰ä»»ä½•ä¸´æ—¶å¯¹è±¡éœ€è¦ç”Ÿæˆå’Œææ„ï¼Œæ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½åªå¤åˆ¶äº†ä¸€æ¬¡ã€‚ä½†æ˜¾ç„¶ä»£ç å°±å•°å—¦å¤šäº†â€”â€”å°¤å…¶å¦‚æœæ‹¼æ¥çš„æ­¥éª¤æ¯”è¾ƒå¤šçš„è¯ã€‚ä» C++11 å¼€å§‹ï¼Œè¿™ä¸å†æ˜¯å¿…é¡»çš„ã€‚åŒæ ·ä¸Šé¢é‚£ä¸ªå•è¡Œçš„è¯­å¥ï¼Œæ‰§è¡Œæµç¨‹å¤§è‡´å¦‚ä¸‹ï¼š

1. è°ƒç”¨æ„é€ å‡½æ•° string(const char*)ï¼Œç”Ÿæˆä¸´æ—¶å¯¹è±¡ 1ï¼›"Hello, " å¤åˆ¶ 1 æ¬¡ã€‚*
2. *è°ƒç”¨ operator+(string&&, const string&)ï¼Œç›´æ¥åœ¨ä¸´æ—¶å¯¹è±¡ 1 ä¸Šé¢æ‰§è¡Œè¿½åŠ æ“ä½œï¼Œå¹¶æŠŠç»“æœç§»åŠ¨åˆ°ä¸´æ—¶å¯¹è±¡ 2ï¼›name å¤åˆ¶ 1 æ¬¡ã€‚*
3. *è°ƒç”¨ operator+(string&&, const char*)ï¼Œç›´æ¥åœ¨ä¸´æ—¶å¯¹è±¡ 2 ä¸Šé¢æ‰§è¡Œè¿½åŠ æ“ä½œï¼Œå¹¶æŠŠç»“æœç§»åŠ¨åˆ° resultï¼›"." å¤åˆ¶ 1 æ¬¡ã€‚
4. ä¸´æ—¶å¯¹è±¡ 2 ææ„ï¼Œå†…å®¹å·²ç»ä¸ºç©ºï¼Œä¸éœ€è¦é‡Šæ”¾ä»»ä½•å†…å­˜ã€‚
5. ä¸´æ—¶å¯¹è±¡ 1 ææ„ï¼Œå†…å®¹å·²ç»ä¸ºç©ºï¼Œä¸éœ€è¦é‡Šæ”¾ä»»ä½•å†…å­˜ã€‚

æ€§èƒ½ä¸Šï¼Œæ‰€æœ‰çš„å­—ç¬¦ä¸²åªå¤åˆ¶äº†ä¸€æ¬¡ï¼›è™½ç„¶æ¯”å•°å—¦çš„å†™æ³•ä»ç„¶è¦å¢åŠ ä¸´æ—¶å¯¹è±¡çš„æ„é€ å’Œææ„ï¼Œä½†ç”±äºè¿™äº›æ“ä½œä¸ç‰µæ¶‰åˆ°é¢å¤–çš„å†…å­˜åˆ†é…å’Œé‡Šæ”¾ï¼Œæ˜¯ç›¸å½“å»‰ä»·çš„ã€‚**ç¨‹åºå‘˜åªéœ€è¦ç‰ºç‰²ä¸€ç‚¹ç‚¹æ€§èƒ½ï¼Œå°±å¯ä»¥å¤§å¤§å¢åŠ ä»£ç çš„å¯è¯»æ€§ã€‚**



æ­¤å¤–å¾ˆå…³é”®çš„ä¸€ç‚¹æ˜¯ï¼ŒC++ é‡Œçš„å¯¹è±¡ç¼ºçœéƒ½æ˜¯å€¼è¯­ä¹‰ã€‚åœ¨ä¸‹é¢è¿™æ ·çš„ä»£ç é‡Œï¼š

```c++
class A {
  B b_;
  C c_;
};
```

ä»å®é™…å†…å­˜å¸ƒå±€çš„è§’åº¦ï¼Œå¾ˆå¤šè¯­è¨€â€”â€”å¦‚ Java å’Œ Pythonâ€”â€”ä¼šåœ¨ A å¯¹è±¡é‡Œæ”¾ B å’Œ C çš„æŒ‡é’ˆï¼ˆè™½ç„¶è¿™äº›è¯­è¨€é‡Œæœ¬èº«æ²¡æœ‰æŒ‡é’ˆçš„æ¦‚å¿µï¼‰ã€‚**è€Œ C++ åˆ™ä¼šç›´æ¥æŠŠ B å’Œ C å¯¹è±¡æ”¾åœ¨ A çš„å†…å­˜ç©ºé—´é‡Œ**ã€‚è¿™ç§è¡Œä¸ºæ—¢æ˜¯ä¼˜ç‚¹ä¹Ÿæ˜¯ç¼ºç‚¹ã€‚è¯´å®ƒæ˜¯ä¼˜ç‚¹ï¼Œæ˜¯å› ä¸ºå®ƒ**ä¿è¯äº†å†…å­˜è®¿é—®çš„å±€åŸŸæ€§**ï¼Œè€Œå±€åŸŸæ€§åœ¨ç°ä»£å¤„ç†å™¨æ¶æ„ä¸Šæ˜¯ç»å¯¹å…·æœ‰æ€§èƒ½ä¼˜åŠ¿çš„ã€‚è¯´å®ƒæ˜¯ç¼ºç‚¹ï¼Œæ˜¯å› ä¸º**å¤åˆ¶å¯¹è±¡çš„å¼€é”€å¤§å¤§å¢åŠ **ï¼šåœ¨ Java ç±»è¯­è¨€é‡Œå¤åˆ¶çš„æ˜¯æŒ‡é’ˆï¼Œåœ¨ C++ é‡Œæ˜¯å®Œæ•´çš„å¯¹è±¡ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ C++ éœ€è¦ç§»åŠ¨è¯­ä¹‰è¿™ä¸€ä¼˜åŒ–ï¼Œè€Œ Java ç±»è¯­è¨€é‡Œåˆ™æ ¹æœ¬ä¸éœ€è¦è¿™ä¸ªæ¦‚å¿µã€‚

## å¦‚ä½•å®ç°ç§»åŠ¨ï¼Ÿ



## ä¸è¦è¿”å›æœ¬åœ°å˜é‡çš„å¼•ç”¨

åœ¨ C++11 ä¹‹å‰ï¼Œè¿”å›ä¸€ä¸ªæœ¬åœ°å¯¹è±¡æ„å‘³ç€è¿™ä¸ªå¯¹è±¡ä¼šè¢«æ‹·è´ï¼Œé™¤éç¼–è¯‘å™¨å‘ç°å¯ä»¥åšè¿”å›å€¼ä¼˜åŒ–ï¼ˆnamed return value optimizationï¼Œæˆ– **NRVO**ï¼‰ï¼Œ**èƒ½æŠŠå¯¹è±¡ç›´æ¥æ„é€ åˆ°è°ƒç”¨è€…çš„æ ˆä¸Š**ã€‚ä» C++11 å¼€å§‹ï¼Œè¿”å›å€¼ä¼˜åŒ–ä»å¯ä»¥å‘ç”Ÿï¼Œä½†åœ¨æ²¡æœ‰è¿”å›å€¼ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å°†è¯•å›¾**æŠŠæœ¬åœ°å¯¹è±¡ç§»åŠ¨å‡ºå»**ï¼Œè€Œä¸æ˜¯æ‹·è´å‡ºå»ã€‚

```c++
#include <iostream>  // std::cout/endl
#include <utility>   // std::move

using namespace std;

class Obj {
public:
  Obj()
  {
    cout << "Obj()" << endl;
  }
  Obj(const Obj&)
  {
    cout << "Obj(const Obj&)"
       << endl;
  }
  Obj(Obj&&)
  {
    cout << "Obj(Obj&&)" << endl;
  }
};

Obj simple()
{
  Obj obj;
  // ç®€å•è¿”å›å¯¹è±¡ï¼›ä¸€èˆ¬æœ‰ NRVO
  return obj;
}

Obj simple_with_move()
{
  Obj obj;
  // move ä¼šç¦æ­¢ NRVO
  return std::move(obj);
}

Obj complicated(int n)
{
  Obj obj1;
  Obj obj2;
  // æœ‰åˆ†æ”¯ï¼Œä¸€èˆ¬æ—  NRVO
  if (n % 2 == 0) {
    return obj1;
  } else {
    return obj2;
  }
}

int main()
{
  cout << "*** 1 ***" << endl;
  auto obj1 = simple();
  cout << "*** 2 ***" << endl;
  auto obj2 = simple_with_move();
  cout << "*** 3 ***" << endl;
  auto obj3 = complicated(42);
}
```



## å¼•ç”¨åç¼©å’Œå®Œç¾è½¬å‘



# 04 | å®¹å™¨æ±‡ç¼– Iï¼šæ¯”è¾ƒç®€å•çš„è‹¥å¹²å®¹å™¨

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´å¥½ç”¨çš„å·¥å…·ã€‚åœ¨æ­¤ï¼Œæˆ‘å‘ä½ å¤§åŠ›æ¨è **xeus-cling**ã€‚å®ƒçš„ä¾¿åˆ©æ€§æ— ä¸ä¼¦æ¯”â€”â€”ä½ å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨é‡Œä»¥äº¤äº’çš„æ–¹å¼è¿è¡Œä»£ç ï¼Œä¸éœ€è¦æœ¬æœºå®‰è£…ä»»ä½•ç¼–è¯‘å™¨ã€‚

## string

è·Ÿå…¶ä»–å¤§éƒ¨åˆ†å®¹å™¨ä¸€æ ·ï¼Œ string å…·æœ‰ä¸‹åˆ—æˆå‘˜å‡½æ•°ï¼š

- begin å¯ä»¥å¾—åˆ°å¯¹è±¡èµ·å§‹ç‚¹
- end å¯ä»¥å¾—åˆ°å¯¹è±¡çš„ç»“æŸç‚¹
- empty å¯ä»¥å¾—åˆ°å®¹å™¨æ˜¯å¦ä¸ºç©º
- size å¯ä»¥å¾—åˆ°å®¹å™¨çš„å¤§å°
- swap å¯ä»¥å’Œå¦å¤–ä¸€ä¸ªå®¹å™¨äº¤æ¢å…¶å†…å®¹

æ‰€æœ‰å®¹å™¨çš„å…±åŒç‚¹äº†ã€‚å‡ ä¹æ˜¯å¦‚ä¸‹ï¼š

- å®¹å™¨éƒ½æœ‰å¼€å§‹å’Œç»“æŸç‚¹

- å®¹å™¨ä¼šè®°å½•å…¶çŠ¶æ€æ˜¯å¦éç©º
- å®¹å™¨æœ‰å¤§å°
- å®¹å™¨æ”¯æŒäº¤æ¢

## vector

å½“ push_backã€insertã€reserveã€resize ç­‰å‡½æ•°å¯¼è‡´å†…å­˜é‡åˆ†é…æ—¶ï¼Œæˆ–å½“ insertã€erase å¯¼è‡´å…ƒç´ ä½ç½®ç§»åŠ¨æ—¶ï¼Œvector ä¼šè¯•å›¾æŠŠå…ƒç´ â€œç§»åŠ¨â€åˆ°æ–°çš„å†…å­˜åŒºåŸŸã€‚vector é€šå¸¸ä¿è¯å¼ºå¼‚å¸¸å®‰å…¨æ€§ï¼Œå¦‚æœå…ƒç´ ç±»å‹æ²¡æœ‰æä¾›ä¸€ä¸ªä¿è¯ä¸æŠ›å¼‚å¸¸çš„ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œvector é€šå¸¸ä¼šä½¿ç”¨æ‹·è´æ„é€ å‡½æ•°ã€‚å› æ­¤ï¼Œå¯¹äºæ‹·è´ä»£ä»·è¾ƒé«˜çš„è‡ªå®šä¹‰å…ƒç´ ç±»å‹ï¼Œæˆ‘ä»¬åº”å½“å®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå¹¶æ ‡å…¶ä¸º noexceptï¼Œæˆ–åªåœ¨å®¹å™¨ä¸­æ”¾ç½®å¯¹è±¡çš„æ™ºèƒ½æŒ‡é’ˆã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä¹‹å‰éœ€è¦åœ¨ smart_ptr çš„å®ç°ä¸­æ ‡ä¸Š noexcept çš„åŸå› ã€‚

vector çš„ä¸€ä¸ªä¸»è¦ç¼ºé™·æ˜¯å¤§å°å¢é•¿æ—¶å¯¼è‡´çš„å…ƒç´ ç§»åŠ¨ã€‚å¦‚æœå¯èƒ½ï¼Œå°½æ—©ä½¿ç”¨ reserve å‡½æ•°ä¸º vector ä¿ç•™æ‰€éœ€çš„å†…å­˜ï¼Œè¿™åœ¨ vector é¢„æœŸä¼šå¢é•¿å¾ˆå¤§æ—¶èƒ½å¸¦æ¥å¾ˆå¤§çš„æ€§èƒ½æå‡ã€‚

## deque



## list

è™½ç„¶ list æä¾›äº†ä»»æ„ä½ç½®æ’å…¥æ–°å…ƒç´ çš„çµæ´»æ€§ï¼Œä½†ç”±äºæ¯ä¸ªå…ƒç´ çš„å†…å­˜ç©ºé—´éƒ½æ˜¯å•ç‹¬åˆ†é…ã€ä¸è¿ç»­ï¼Œå®ƒçš„éå†æ€§èƒ½æ¯” vector å’Œ deque éƒ½è¦ä½ã€‚



## forward_list



## queue

å®ƒä»¬çš„ç‰¹åˆ«ç‚¹åœ¨äºå®ƒä»¬éƒ½ä¸æ˜¯å®Œæ•´çš„å®ç°ï¼Œè€Œæ˜¯ä¾èµ–äºæŸä¸ªç°æœ‰çš„å®¹å™¨ï¼Œå› è€Œè¢«ç§°ä¸ºå®¹å™¨é€‚é…å™¨ï¼ˆcontainer adaptorï¼‰ã€‚



## stack

å®ƒä»¬çš„ç‰¹åˆ«ç‚¹åœ¨äºå®ƒä»¬éƒ½ä¸æ˜¯å®Œæ•´çš„å®ç°ï¼Œè€Œæ˜¯ä¾èµ–äºæŸä¸ªç°æœ‰çš„å®¹å™¨ï¼Œå› è€Œè¢«ç§°ä¸ºå®¹å™¨é€‚é…å™¨ï¼ˆcontainer adaptorï¼‰ã€‚



# 05 | å®¹å™¨æ±‡ç¼– IIï¼šéœ€è¦å‡½æ•°å¯¹è±¡çš„å®¹å™¨

## å‡½æ•°å¯¹è±¡åŠå…¶ç‰¹åŒ–

less

hash

## priority_queue

priority_queue ä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨é€‚é…å™¨ã€‚ä¸Šä¸€è®²æ²¡æœ‰å’Œå…¶ä»–å®¹å™¨é€‚é…å™¨ä¸€èµ·è®²çš„åŸå› å°±åœ¨äºå®ƒç”¨åˆ°äº†æ¯”è¾ƒå‡½æ•°å¯¹è±¡ï¼ˆé»˜è®¤æ˜¯ lessï¼‰ã€‚

## å…³è”å®¹å™¨

å…³è”å®¹å™¨æœ‰ setï¼ˆé›†åˆï¼‰ã€mapï¼ˆæ˜ å°„ï¼‰ã€multisetï¼ˆå¤šé‡é›†ï¼‰å’Œ multimapï¼ˆå¤šé‡æ˜ å°„ï¼‰ã€‚è·³å‡º C++ çš„è¯­å¢ƒï¼Œmapï¼ˆæ˜ å°„ï¼‰çš„æ›´å¸¸è§çš„åå­—æ˜¯å…³è”æ•°ç»„å’Œå­—å…¸ï¼Œè€Œåœ¨ JSON é‡Œç›´æ¥è¢«ç§°ä¸ºå¯¹è±¡ï¼ˆobjectï¼‰ã€‚åœ¨ C++ å¤–è¿™äº›å®¹å™¨å¸¸å¸¸æ˜¯æ— åºçš„ï¼›åœ¨ C++ é‡Œå…³è”å®¹å™¨åˆ™è¢«è®¤ä¸ºæ˜¯æœ‰åºçš„ã€‚

å¦‚æœåœ¨å£°æ˜å…³è”å®¹å™¨æ—¶æ²¡æœ‰æä¾›æ¯”è¾ƒç±»å‹çš„å‚æ•°ï¼Œç¼ºçœä½¿ç”¨ less æ¥è¿›è¡Œæ’åºã€‚å¦‚æœé”®çš„ç±»å‹æä¾›äº†æ¯”è¾ƒç®—ç¬¦ < çš„é‡è½½ï¼Œæˆ‘ä»¬ä¸éœ€è¦åšä»»ä½•é¢å¤–çš„å·¥ä½œã€‚

## æ— åºå…³è”å®¹å™¨

ä» C++11 å¼€å§‹ï¼Œæ¯ä¸€ä¸ªå…³è”å®¹å™¨éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„æ— åºå…³è”å®¹å™¨ï¼Œå®ƒä»¬æ˜¯ï¼š

- unordered_set
- unordered_map
- unordered_multiset
- unordered_multimap

## array

æˆ‘ä»¬è®²çš„æœ€åä¸€ä¸ªå®¹å™¨æ˜¯ C æ•°ç»„çš„æ›¿ä»£å“ã€‚C æ•°ç»„åœ¨ C++ é‡Œç»§ç»­å­˜åœ¨ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä¿ç•™å’Œ C çš„å‘åå…¼å®¹æ€§ã€‚C æ•°ç»„æœ¬èº«å’Œ C++ çš„å®¹å™¨ç›¸å·®æ˜¯éå¸¸å¤§çš„ï¼š

- C æ•°ç»„æ²¡æœ‰ begin å’Œ end æˆå‘˜å‡½æ•°ï¼ˆè™½ç„¶å¯ä»¥ä½¿ç”¨å…¨å±€çš„ begin å’Œ end å‡½æ•°ï¼‰
- C æ•°ç»„æ²¡æœ‰ size æˆå‘˜å‡½æ•°ï¼ˆå¾—ç”¨ä¸€äº›æ¨¡æ¿æŠ€å·§æ¥è·å–å…¶é•¿åº¦ï¼‰
- C æ•°ç»„ä½œä¸º**å‚æ•°æœ‰é€€åŒ–è¡Œä¸º**ï¼Œä¼ é€’ç»™å¦å¤–ä¸€ä¸ªå‡½æ•°åé‚£ä¸ªå‡½æ•°ä¸å†èƒ½è·å¾— C æ•°ç»„çš„é•¿åº¦å’Œç»“æŸä½ç½®

# 06 | å¼‚å¸¸ï¼šç”¨è¿˜æ˜¯ä¸ç”¨ï¼Œè¿™æ˜¯ä¸ªé—®é¢˜

å¼‚å¸¸ è¯¥ç”¨ã€‚å¦‚æœä½ éœ€è¦é¿å…ä½¿ç”¨å¼‚å¸¸ï¼ŒåŸå› å¿…é¡»æ˜¯ä½ æœ‰æ˜ç¡®çš„éœ€è¦é¿å…ä½¿ç”¨å¼‚å¸¸çš„ç†ç”±ã€‚

å¦‚æœå‡ºé”™ä½ç½®ç¦»å¤„ç†é”™è¯¯çš„ä½ç½®ç›¸å·®å¾ˆè¿œçš„è¯ï¼Œ**æ¯ä¸€å±‚çš„å‡½æ•°è°ƒç”¨é‡Œéƒ½å¾—æœ‰åˆ¤æ–­é”™è¯¯ç çš„ä»£ç **ï¼Œè¿™å°±æ—¢å¯¹å†™ä»£ç çš„äººæå‡ºäº†ä¸¥æ ¼è¦æ±‚ï¼Œä¹Ÿå¯¹è¯»ä»£ç çš„äººé€ æˆäº†è§†è§‰ä¸Šçš„å¹²æ‰°â€¦â€¦

## ä½¿ç”¨å¼‚å¸¸

å¼‚å¸¸å¤„ç†å¹¶ä¸æ„å‘³ç€éœ€è¦å†™æ˜¾å¼çš„ try å’Œ catchã€‚**å¼‚å¸¸å®‰å…¨çš„ä»£ç ï¼Œå¯ä»¥æ²¡æœ‰ä»»ä½• try å’Œ catchã€‚**

**å¼‚å¸¸å®‰å…¨**ï¼šæˆ‘ä»¬å…ˆæ¥æ¸©ä¹ ä¸€ä¸‹æ¦‚å¿µï¼šå¼‚å¸¸å®‰å…¨æ˜¯æŒ‡å½“å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œæ—¢ä¸ä¼šå‘ç”Ÿèµ„æºæ³„æ¼ï¼Œç³»ç»Ÿä¹Ÿä¸ä¼šå¤„äºä¸€ä¸ªä¸ä¸€è‡´çš„çŠ¶æ€ã€‚

ä½¿ç”¨å¼‚å¸¸ä¼šå¸¦æ¥äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°çš„ä¸Šå‡ï¼Œä»¥åŠæ€§èƒ½çš„é™ä½ï¼Œä½†æ˜¯é™¤éåœ¨æç«¯è¿½æ±‚æ€§èƒ½çš„åœºæ™¯ä¸‹ï¼Œç›®å‰ä¸»æµçš„c++ç¼–è¯‘å™¨åœ¨å¼‚å¸¸å…³é—­å’Œå¼€å¯æ—¶åº”è¯¥å·²ç»èƒ½å¤Ÿäº§ç”Ÿæ€§èƒ½å·®ä¸å¤šçš„ä»£ç ï¼ˆåœ¨å¼‚å¸¸æœªæŠ›å‡ºæ—¶ï¼‰ã€‚

## ä½¿ç”¨å¼‚å¸¸çš„ç†ç”±

æ ‡å‡†åº“çš„é”™è¯¯å¤„ç†æ–¹å¼å°±æ˜¯å¼‚å¸¸ã€‚å…¶ä¸­ä¸ä»…åŒ…æ‹¬è¿è¡Œæ—¶é”™è¯¯ï¼Œç”šè‡³åŒ…æ‹¬ä¸€äº›é€»è¾‘é”™è¯¯ã€‚

æ¯”å¦‚ï¼Œåœ¨è¯´å®¹å™¨çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªæˆ‘æ²¡æçš„åœ°æ–¹æ˜¯ï¼Œåœ¨èƒ½ä½¿ç”¨ [] è¿ç®—ç¬¦çš„åœ°æ–¹ï¼ŒC++ çš„æ ‡å‡†å®¹å™¨ä¹Ÿæä¾›äº† at æˆå‘˜å‡½æ•°ï¼Œèƒ½å¤Ÿåœ¨ä¸‹æ ‡ä¸å­˜åœ¨çš„æ—¶å€™æŠ›å‡ºå¼‚å¸¸ï¼Œä½œä¸ºä¸€ç§é¢å¤–çš„å¸®åŠ©è°ƒè¯•çš„æ‰‹æ®µ

C++ çš„æ ‡å‡†å®¹å™¨åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹æä¾›äº†**å¼ºå¼‚å¸¸ä¿è¯**ï¼Œå³ï¼Œ<u>ä¸€æ—¦å¼‚å¸¸å‘ç”Ÿï¼Œç°åœºä¼šæ¢å¤åˆ°è°ƒç”¨å‡½æ•°ä¹‹å‰çš„çŠ¶æ€ï¼Œå®¹å™¨çš„å†…å®¹ä¸ä¼šå‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•èµ„æºæ³„æ¼ã€‚</u>



# 07 | è¿­ä»£å™¨å’Œå¥½ç”¨çš„æ–°forå¾ªç¯

æ³¨æ„åœ¨ C++17 ä¹‹å‰ï¼Œbegin å’Œ end è¿”å›çš„ç±»å‹ I å’Œ S å¿…é¡»æ˜¯ç›¸åŒçš„ã€‚ä» C++17 å¼€å§‹ï¼ŒI å’Œ S å¯ä»¥æ˜¯ä¸åŒçš„ç±»å‹ã€‚è¿™å¸¦æ¥äº†æ›´å¤§çš„çµæ´»æ€§å’Œæ›´å¤šçš„ä¼˜åŒ–å¯èƒ½æ€§ã€‚

è€Œæ¯”è¾“å…¥è¿­ä»£å™¨å’Œè¾“å‡ºè¿­ä»£å™¨æ›´åº•å±‚çš„æ¦‚å¿µï¼Œå°±æ˜¯è¿­ä»£å™¨äº†ã€‚åŸºæœ¬è¦æ±‚æ˜¯ï¼š

- å¯¹è±¡å¯ä»¥è¢«æ‹·è´æ„é€ ã€æ‹·è´èµ‹å€¼å’Œææ„ã€‚
- å¯¹è±¡æ”¯æŒ * è¿ç®—ç¬¦ã€‚
- å¯¹è±¡æ”¯æŒå‰ç½® ++ è¿ç®—ç¬¦ã€‚

è¿­ä»£å™¨ç±»å‹çš„å…³ç³»å¯ä»ä¸‹å›¾ä¸­å…¨éƒ¨çœ‹åˆ°ï¼š

![image-20220329084316496](../images/image-20220329084316496.png)

æŒ‡é’ˆå¯ä»¥æ»¡è¶³ä¸Šé¢æ‰€æœ‰çš„è¿­ä»£å™¨è¦æ±‚ï¼Œå› è€Œä¹Ÿæ˜¯è¿­ä»£å™¨ã€‚

## å¸¸ç”¨è¿­ä»£å™¨

æœ€å¸¸ç”¨çš„è¿­ä»£å™¨å°±æ˜¯å®¹å™¨çš„ iterator ç±»å‹äº†ã€‚ä»¥æˆ‘ä»¬å­¦è¿‡çš„é¡ºåºå®¹å™¨ä¸ºä¾‹ï¼Œå®ƒä»¬éƒ½å®šä¹‰äº†åµŒå¥—çš„ iterator ç±»å‹å’Œ const_iterator ç±»å‹ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œiterator å¯å†™å…¥ï¼Œconst_iterator ç±»å‹ä¸å¯å†™å…¥ï¼Œä½†è¿™äº›è¿­ä»£å™¨éƒ½è¢«å®šä¹‰ä¸ºè¾“å…¥è¿­ä»£å™¨æˆ–å…¶æ´¾ç”Ÿç±»å‹ï¼š

- vector::iterator å’Œ array::iterator å¯ä»¥æ»¡è¶³åˆ°è¿ç»­è¿­ä»£å™¨ã€‚
- deque::iterator å¯ä»¥æ»¡è¶³åˆ°éšæœºè®¿é—®è¿­ä»£å™¨ï¼ˆè®°å¾—å®ƒçš„å†…å­˜åªæœ‰éƒ¨åˆ†è¿ç»­ï¼‰ã€‚
- list::iterator å¯ä»¥æ»¡è¶³åˆ°åŒå‘è¿­ä»£å™¨ï¼ˆé“¾è¡¨ä¸èƒ½å¿«é€Ÿè·³è½¬ï¼‰ã€‚
- forward_list::iterator å¯ä»¥æ»¡è¶³åˆ°å‰å‘è¿­ä»£å™¨ï¼ˆå•å‘é“¾è¡¨ä¸èƒ½åå‘éå†ï¼‰

å¾ˆå¸¸è§çš„ä¸€ä¸ªè¾“å‡ºè¿­ä»£å™¨æ˜¯ back_inserter è¿”å›çš„ç±»å‹ back_inserter_iterator äº†ï¼›ç”¨å®ƒæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨å®¹å™¨çš„å°¾éƒ¨è¿›è¡Œæ’å…¥æ“ä½œã€‚å¦å¤–ä¸€ä¸ªå¸¸è§çš„è¾“å‡ºè¿­ä»£å™¨æ˜¯ ostream_iteratorï¼Œæ–¹ä¾¿æˆ‘ä»¬æŠŠå®¹å™¨å†…å®¹â€œæ‹·è´â€åˆ°ä¸€ä¸ªè¾“å‡ºæµã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š

```c++
#include <algorithm>  // std::copy
#include <iterator>   // std::back_inserter
#include <vector>     // std::vector
using namespace std;

vector<int> v1{1, 2, 3, 4, 5};
vector<int> v2;
copy(v1.begin(), v1.end(),
     back_inserter(v2));
// { 1, 2, 3, 4, 5 }

#include <iostream>  // std::cout
copy(v2.begin(), v2.end(),
     ostream_iterator<int>(cout, " "));
// 1 2 3 4 5
```



## å®šä¹‰è¾“å…¥è¡Œè¿­ä»£å™¨

æŠŠä¸€ä¸ªè¾“å…¥æµï¼ˆistreamï¼‰çš„å†…å®¹ä¸€è¡Œè¡Œè¯»è¿›æ¥ã€‚é…ä¸Š C++11 å¼•å…¥çš„åŸºäºèŒƒå›´çš„ for å¾ªç¯çš„è¯­æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠéå†è¾“å…¥æµçš„ä»£ç ä»¥ä¸€ç§è‡ªç„¶ã€éè¿‡ç¨‹å¼çš„æ–¹å¼å†™å‡ºæ¥:

```c++
for (const string& line :
     istream_line_reader(is)) {
  // ç¤ºä¾‹å¾ªç¯ä½“ä¸­ä»…è¿›è¡Œç®€å•è¾“å‡º
  cout << line << endl;
}
```

æˆ‘ä»¬å¯ä»¥å¯¹æ¯”ä¸€ä¸‹ä»¥ä¼ ç»Ÿçš„æ–¹å¼å†™çš„ C++ ä»£ç ï¼Œå…¶ä¸­éœ€è¦ç…§é¡¾ä¸å°‘ç»†èŠ‚ï¼š

```c++
string line;
for (;;) {
  getline(is, line);
  if (!is) {
    break;
  }
  cout << line << endl;
}
```

æˆ‘ä»¬åé¢ä¼šåˆ†æä¸€ä¸‹è¿™ä¸ªè¾“å…¥è¿­ä»£å™¨ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘å…ˆè§£è¯´ä¸€ä¸‹åŸºäºèŒƒå›´çš„ for å¾ªç¯è¿™ä¸ªè¯­æ³•ã€‚è™½ç„¶è¿™å¯ä»¥è¯´æ˜¯ä¸ªè¯­æ³•ç³–ï¼Œä½†å®ƒå¯¹æé«˜ä»£ç çš„å¯è¯»æ€§çœŸçš„éå¸¸é‡è¦ã€‚å¦‚æœä¸ç”¨è¿™ä¸ªè¯­æ³•ç³–çš„è¯ï¼Œç®€æ´æ€§ä¸Šçš„ä¼˜åŠ¿å°±å°å¤šäº†ã€‚æˆ‘ä»¬ç›´æ¥æŠŠè¿™ä¸ªå¾ªç¯æ”¹å†™æˆç­‰ä»·çš„æ™®é€š for å¾ªç¯çš„æ ·å­ã€‚

```c++
{
  auto&& r = istream_line_reader(is);
  auto it = r.begin();
  auto end = r.end();
  for (; it != end; ++it) {
    const string& line = *it;
    cout << line << endl;
  }
}
```

å¯ä»¥çœ‹åˆ°ï¼Œå®ƒåšçš„äº‹æƒ…ä¹Ÿä¸å¤æ‚ï¼Œå°±æ˜¯ï¼š

- è·å–å†’å·åè¾¹çš„èŒƒå›´è¡¨è¾¾å¼çš„ç»“æœï¼Œå¹¶éšå¼äº§ç”Ÿä¸€ä¸ªå¼•ç”¨ï¼Œåœ¨æ•´ä¸ªå¾ªç¯æœŸé—´éƒ½æœ‰æ•ˆã€‚æ³¨**æ„æ ¹æ®ç”Ÿå‘½æœŸå»¶é•¿è§„åˆ™ï¼Œè¡¨è¾¾å¼ç»“æœå¦‚æœæ˜¯ä¸´æ—¶å¯¹è±¡çš„è¯ï¼Œè¿™ä¸ªå¯¹è±¡è¦åœ¨å¾ªç¯ç»“æŸåæ‰è¢«é”€æ¯ã€‚**
- è‡ªåŠ¨ç”Ÿæˆéå†è¿™ä¸ªèŒƒå›´çš„è¿­ä»£å™¨ã€‚
- å¾ªç¯å†…è‡ªåŠ¨ç”Ÿæˆæ ¹æ®å†’å·å·¦è¾¹çš„å£°æ˜å’Œ *it æ¥è¿›è¡Œåˆå§‹åŒ–çš„è¯­å¥ã€‚

















